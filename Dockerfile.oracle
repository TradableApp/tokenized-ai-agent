# Use a modern, slim Node.js base image
FROM node:22-slim

# Set the root working directory for the entire application
WORKDIR /app

# Copy the compiled contract artifacts first, as they are needed by the oracle
COPY ./artifacts ./artifacts

# Now, set the working directory to the oracle's specific subdirectory
WORKDIR /app/oracle

# Copy the oracle's package files and install production dependencies
COPY ./oracle/package*.json ./
RUN npm install --omit=dev --no-progress

# Copy the oracle's source code into the current directory (/app/oracle)
COPY ./oracle/src ./src

# The command will be run from /app/oracle, so the entrypoint path is simple
CMD ["node", "src/index.js"]